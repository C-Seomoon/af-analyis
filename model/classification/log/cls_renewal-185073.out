=============================================
[INFO] Job Information
---------------------------------------------
[INFO] Job Name       : cls_framework
[INFO] Job ID         : 185073
[INFO] Submit Dir     : /home/cseomoon/appl/af_analysis-0.1.4/model/classification/scripts
[INFO] Partition      : a5000_short
[INFO] Node List      : gpu2
[INFO] Nodes          : 1
[INFO] CPUs per Task  : 32
[INFO] Memory (MB)    : 
[INFO] User           : cseomoon
[INFO] Work Dir       : /home/cseomoon/appl/af_analysis-0.1.4/model/classification/scripts
[INFO] Tasks per Node : 1
[INFO] Dependency     : 
[INFO] GPU(s)         : 
=============================================

[INFO] Job started at : Tue Apr 29 04:24:39 KST 2025
[INFO] Job allocated on node(s): gpu2
[INFO] Job running on: gpu2
[INFO] Results will be saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439
Using 32 CPU cores.
Results will be saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/run_arguments.json

--- Loading Data ---
Original data shape: (3650, 81)
Class distribution before NaN drop (DockQ >= 0.23): 0 (Negative) = 2529, 1 (Positive) = 1121
Identified 63 potential feature columns.
Checking for NaN values in potential feature columns...
Dropped 3 rows containing NaN values in one or more feature columns.
Processed Features (X) shape after NaN drop: (3647, 63)
Processed Target (y) shape after NaN drop: (3647,)
Processed Query IDs shape after NaN drop: (3647,)
Class distribution after NaN drop (DockQ >= 0.23): 0 (Negative) = 2526, 1 (Positive) = 1121
Data Loading & Preprocessing Duration: 0.06 seconds

--- Starting Model Training ---

--- Running Nested CV for: Random Forest (rf) ---
Output directory: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf
Using StratifiedGroupKFold for outer CV with 2 folds based on query IDs and stratified by y.

-- Processing Outer Fold 1/2 --
Train set size: (1848, 63), Test set size: (1799, 63)
Test set indices range from 100 to 3646
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Best Params found: {'n_estimators': 100, 'min_samples_split': 5, 'min_samples_leaf': 1, 'max_features': 'log2', 'max_depth': 20, 'class_weight': 'balanced_subsample'}
Best Inner CV PR-AUC score: 0.8702
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_1/best_params.json
CV metrics for best model: PR-AUC=0.8702, ROC-AUC=0.9301, F1=0.7958, Balanced Acc=0.8681
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_1/cv_metrics.json
Hyperparameter Tuning Duration: 8.54 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_1/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_1/predictions.csv
Default threshold (0.5): F1=0.8252
Optimal threshold (0.2376): F1=0.8319
Prediction & Evaluation Duration: 0.20 seconds
Calculating and saving SHAP values...
Calculating SHAP values for RandomForest using TreeExplainer...
Returning SHAP values for the positive class (from 3D array).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_1/shap_values_fold_1.csv (shape: (1799, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_1/test_data_fold_1.csv (shape: (1799, 63))
SHAP Calculation & Saving Duration: 3.19 seconds
-- Outer Fold 1 finished. Duration: 11.95 seconds --

-- Processing Outer Fold 2/2 --
Train set size: (1799, 63), Test set size: (1848, 63)
Test set indices range from 0 to 3596
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Best Params found: {'n_estimators': 700, 'min_samples_split': 2, 'min_samples_leaf': 4, 'max_features': 'log2', 'max_depth': 30, 'class_weight': 'balanced_subsample'}
Best Inner CV PR-AUC score: 0.9233
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_2/best_params.json
CV metrics for best model: PR-AUC=0.9233, ROC-AUC=0.9483, F1=0.8114, Balanced Acc=0.8561
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_2/cv_metrics.json
Hyperparameter Tuning Duration: 6.72 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_2/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_2/predictions.csv
Default threshold (0.5): F1=0.7530
Optimal threshold (0.4375): F1=0.7678
Prediction & Evaluation Duration: 0.42 seconds
Calculating and saving SHAP values...
Calculating SHAP values for RandomForest using TreeExplainer...
Returning SHAP values for the positive class (from 3D array).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_2/shap_values_fold_2.csv (shape: (1848, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/fold_2/test_data_fold_2.csv (shape: (1848, 63))
SHAP Calculation & Saving Duration: 13.91 seconds
-- Outer Fold 2 finished. Duration: 21.06 seconds --

--- Aggregating results for: Random Forest (rf) ---
Average Metrics across folds:
{
    "accuracy_mean": 0.880339666818266,
    "accuracy_std": 0.008188471709872469,
    "precision_mean": 0.8247417754382053,
    "precision_std": 0.035797051820114834,
    "recall_mean": 0.7564421080827697,
    "recall_std": 0.036258621844237615,
    "f1_mean": 0.7891127827221505,
    "f1_std": 0.03611518080368531,
    "roc_auc_mean": 0.9325864597250342,
    "roc_auc_std": 0.002400894322325986,
    "pr_auc_mean": 0.8811261430780775,
    "pr_auc_std": 0.021091754319943035,
    "balanced_accuracy_mean": 0.8435998792940282,
    "balanced_accuracy_std": 0.01325317866768011,
    "mcc_mean": 0.7043093656274048,
    "mcc_std": 0.021915639822376987,
    "best_inner_cv_pr_auc_mean": 0.8967790303853024,
    "best_inner_cv_pr_auc_std": 0.026530493591934712,
    "default_threshold_mean": 0.5,
    "default_threshold_std": 0.0,
    "optimal_threshold_mean": 0.3375659312055585,
    "optimal_threshold_std": 0.09991982730945463,
    "optimal_f1_mean": 0.7998526424787925,
    "optimal_f1_std": 0.03208013063045123,
    "threshold_improvement_mean": 0.01073985975664199,
    "threshold_improvement_std": 0.004035050173234078,
    "threshold_used_mean": 0.5,
    "threshold_used_std": 0.0
}
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/metrics_summary.json
Combined predictions saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/rf/all_predictions.csv

Running global SHAP analysis...
Combined SHAP values shape: (3647, 63)
Combined test data shape: (3647, 63)
Global SHAP analysis completed using data from all 2 folds
Global SHAP Analysis Duration: 2.22 seconds
Result Aggregation & Global SHAP Duration: 2.31 seconds
Average time per outer fold: 16.50 seconds
--- Nested CV completed for: Random Forest (rf) ---
Total execution time for model 'rf': 35.34 seconds

--- Running Nested CV for: XGBoost (xgb) ---
Output directory: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb
Using StratifiedGroupKFold for outer CV with 2 folds based on query IDs and stratified by y.

-- Processing Outer Fold 1/2 --
Train set size: (1848, 63), Test set size: (1799, 63)
Test set indices range from 100 to 3646
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Best Params found: {'subsample': 0.8, 'scale_pos_weight': 5, 'n_estimators': 100, 'max_depth': 3, 'learning_rate': 0.2, 'gamma': 0.5, 'colsample_bytree': 0.8}
Best Inner CV PR-AUC score: 0.8485
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_1/best_params.json
CV metrics for best model: PR-AUC=0.8485, ROC-AUC=0.9253, F1=0.7749, Balanced Acc=0.8582
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_1/cv_metrics.json
Hyperparameter Tuning Duration: 5.08 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_1/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_1/predictions.csv
Default threshold (0.5): F1=0.8161
Optimal threshold (0.2061): F1=0.8219
Prediction & Evaluation Duration: 0.10 seconds
Calculating and saving SHAP values...
Calculating SHAP values for XGBoost using TreeExplainer...
Returning SHAP values (expected 2D array for positive class log-odds).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_1/shap_values_fold_1.csv (shape: (1799, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_1/test_data_fold_1.csv (shape: (1799, 63))
SHAP Calculation & Saving Duration: 0.48 seconds
-- Outer Fold 1 finished. Duration: 5.70 seconds --

-- Processing Outer Fold 2/2 --
Train set size: (1799, 63), Test set size: (1848, 63)
Test set indices range from 0 to 3596
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Best Params found: {'subsample': 0.8, 'scale_pos_weight': 5, 'n_estimators': 100, 'max_depth': 3, 'learning_rate': 0.2, 'gamma': 0.5, 'colsample_bytree': 0.8}
Best Inner CV PR-AUC score: 0.9093
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_2/best_params.json
CV metrics for best model: PR-AUC=0.9093, ROC-AUC=0.9267, F1=0.7936, Balanced Acc=0.8438
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_2/cv_metrics.json
Hyperparameter Tuning Duration: 2.91 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_2/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_2/predictions.csv
Default threshold (0.5): F1=0.7971
Optimal threshold (0.3728): F1=0.8190
Prediction & Evaluation Duration: 0.07 seconds
Calculating and saving SHAP values...
Calculating SHAP values for XGBoost using TreeExplainer...
Returning SHAP values (expected 2D array for positive class log-odds).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_2/shap_values_fold_2.csv (shape: (1848, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/fold_2/test_data_fold_2.csv (shape: (1848, 63))
SHAP Calculation & Saving Duration: 0.48 seconds
-- Outer Fold 2 finished. Duration: 3.46 seconds --

--- Aggregating results for: XGBoost (xgb) ---
Average Metrics across folds:
{
    "accuracy_mean": 0.8861667677329157,
    "accuracy_std": 0.02346526689911904,
    "precision_mean": 0.8401859836793037,
    "precision_std": 0.007359235958939114,
    "recall_mean": 0.7761467889908258,
    "recall_std": 0.023853211009174313,
    "f1_mean": 0.8065836174973242,
    "f1_std": 0.009499777886145644,
    "roc_auc_mean": 0.9281554139485032,
    "roc_auc_std": 0.010452390714022375,
    "pr_auc_mean": 0.8954870106389579,
    "pr_auc_std": 0.0005264577834441786,
    "balanced_accuracy_mean": 0.852941401981897,
    "balanced_accuracy_std": 0.0023130357341411556,
    "mcc_mean": 0.7241890285616874,
    "mcc_std": 0.017205727434480067,
    "best_inner_cv_pr_auc_mean": 0.8788946257890351,
    "best_inner_cv_pr_auc_std": 0.030435935685411586,
    "default_threshold_mean": 0.5,
    "default_threshold_std": 0.0,
    "optimal_threshold_mean": 0.28944647312164307,
    "optimal_threshold_std": 0.08339385688304901,
    "optimal_f1_mean": 0.8204716651304707,
    "optimal_f1_std": 0.00144614308870733,
    "threshold_improvement_mean": 0.013888047633146494,
    "threshold_improvement_std": 0.008053634797438314,
    "threshold_used_mean": 0.5,
    "threshold_used_std": 0.0
}
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/metrics_summary.json
Combined predictions saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/xgb/all_predictions.csv

Running global SHAP analysis...
Combined SHAP values shape: (3647, 63)
Combined test data shape: (3647, 63)
Global SHAP analysis completed using data from all 2 folds
Global SHAP Analysis Duration: 1.59 seconds
Result Aggregation & Global SHAP Duration: 1.71 seconds
Average time per outer fold: 4.58 seconds
--- Nested CV completed for: XGBoost (xgb) ---
Total execution time for model 'xgb': 10.91 seconds

--- Running Nested CV for: LightGBM (lgb) ---
Output directory: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb
Using StratifiedGroupKFold for outer CV with 2 folds based on query IDs and stratified by y.

-- Processing Outer Fold 1/2 --
Train set size: (1848, 63), Test set size: (1799, 63)
Test set indices range from 100 to 3646
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Best Params found: {'subsample': 0.8, 'reg_lambda': 0, 'reg_alpha': 0.1, 'num_leaves': 20, 'n_estimators': 300, 'max_depth': 20, 'learning_rate': 0.05, 'colsample_bytree': 0.6, 'class_weight': 'balanced'}
Best Inner CV PR-AUC score: 0.8517
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_1/best_params.json
CV metrics for best model: PR-AUC=0.8517, ROC-AUC=0.9250, F1=0.7784, Balanced Acc=0.8594
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_1/cv_metrics.json
Hyperparameter Tuning Duration: 9.61 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_1/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_1/predictions.csv
Default threshold (0.5): F1=0.8153
Optimal threshold (0.1544): F1=0.8251
Prediction & Evaluation Duration: 0.19 seconds
Calculating and saving SHAP values...
Calculating SHAP values for LightGBM using TreeExplainer...
Warning: TreeExplainer returned a 2D array for LightGBM. Assuming it relates to the positive class.
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_1/shap_values_fold_1.csv (shape: (1799, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_1/test_data_fold_1.csv (shape: (1799, 63))
SHAP Calculation & Saving Duration: 0.71 seconds
-- Outer Fold 1 finished. Duration: 10.53 seconds --

-- Processing Outer Fold 2/2 --
Train set size: (1799, 63), Test set size: (1848, 63)
Test set indices range from 0 to 3596
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Best Params found: {'subsample': 1.0, 'reg_lambda': 1, 'reg_alpha': 0.5, 'num_leaves': 40, 'n_estimators': 500, 'max_depth': -1, 'learning_rate': 0.01, 'colsample_bytree': 0.6, 'class_weight': 'balanced'}
Best Inner CV PR-AUC score: 0.9181
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_2/best_params.json
CV metrics for best model: PR-AUC=0.9181, ROC-AUC=0.9392, F1=0.8348, Balanced Acc=0.8743
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_2/cv_metrics.json
Hyperparameter Tuning Duration: 12.63 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_2/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_2/predictions.csv
Default threshold (0.5): F1=0.7650
Optimal threshold (0.9314): F1=0.7785
Prediction & Evaluation Duration: 0.14 seconds
Calculating and saving SHAP values...
Calculating SHAP values for LightGBM using TreeExplainer...
Warning: TreeExplainer returned a 2D array for LightGBM. Assuming it relates to the positive class.
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_2/shap_values_fold_2.csv (shape: (1848, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/fold_2/test_data_fold_2.csv (shape: (1848, 63))
SHAP Calculation & Saving Duration: 1.24 seconds
-- Outer Fold 2 finished. Duration: 14.05 seconds --

--- Aggregating results for: LightGBM (lgb) ---
Average Metrics across folds:
{
    "accuracy_mean": 0.8761559452220931,
    "accuracy_std": 0.013454444388296516,
    "precision_mean": 0.8022040445353329,
    "precision_std": 0.03368552601681435,
    "recall_mean": 0.7785441639322306,
    "recall_std": 0.01707627402397377,
    "f1_mean": 0.790117499457138,
    "f1_std": 0.02514054093179241,
    "roc_auc_mean": 0.9310389977445477,
    "roc_auc_std": 0.0024342460114624154,
    "pr_auc_mean": 0.8956058448911262,
    "pr_auc_std": 0.020203241254207083,
    "balanced_accuracy_mean": 0.8475541322048996,
    "balanced_accuracy_std": 0.0022309521232923846,
    "mcc_mean": 0.6997604312158219,
    "mcc_std": 0.006904689628298766,
    "best_inner_cv_pr_auc_mean": 0.8848976380237756,
    "best_inner_cv_pr_auc_std": 0.03320971119896127,
    "default_threshold_mean": 0.5,
    "default_threshold_std": 0.0,
    "optimal_threshold_mean": 0.5429109811433515,
    "optimal_threshold_std": 0.3884736409277621,
    "optimal_f1_mean": 0.8017893920346644,
    "optimal_f1_std": 0.023283494262711646,
    "threshold_improvement_mean": 0.011671892577526377,
    "threshold_improvement_std": 0.001857046669080764,
    "threshold_used_mean": 0.5,
    "threshold_used_std": 0.0
}
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/metrics_summary.json
Combined predictions saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/lgb/all_predictions.csv

Running global SHAP analysis...
Combined SHAP values shape: (3647, 63)
Combined test data shape: (3647, 63)
Global SHAP analysis completed using data from all 2 folds
Global SHAP Analysis Duration: 1.53 seconds
Result Aggregation & Global SHAP Duration: 1.67 seconds
Average time per outer fold: 12.29 seconds
--- Nested CV completed for: LightGBM (lgb) ---
Total execution time for model 'lgb': 26.30 seconds

--- Running Nested CV for: Logistic Regression (logistic) ---
Output directory: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic
Using StratifiedGroupKFold for outer CV with 2 folds based on query IDs and stratified by y.

-- Processing Outer Fold 1/2 --
Train set size: (1848, 63), Test set size: (1799, 63)
Test set indices range from 100 to 3646
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Best Params found: {'model__solver': 'saga', 'model__penalty': 'l1', 'model__max_iter': 2000, 'model__class_weight': None, 'model__C': 0.046415888336127774}
Best Inner CV PR-AUC score: 0.8805
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_1/best_params.json
CV metrics for best model: PR-AUC=0.8805, ROC-AUC=0.9358, F1=0.8190, Balanced Acc=0.8671
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_1/cv_metrics.json
Hyperparameter Tuning Duration: 2.78 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_1/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_1/predictions.csv
Default threshold (0.5): F1=0.8347
Optimal threshold (0.8853): F1=0.8507
Prediction & Evaluation Duration: 0.13 seconds
Calculating and saving SHAP values...
Calculating SHAP values using shap.Explainer with predict_proba for Pipeline...
Warning: Background data (X_background) not provided. Using 100 samples from X_test.
Returning 2D SHAP values array from shap.Explainer (predict_proba).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_1/shap_values_fold_1.csv (shape: (1799, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_1/test_data_fold_1.csv (shape: (1799, 63))
SHAP Calculation & Saving Duration: 50.53 seconds
-- Outer Fold 1 finished. Duration: 53.53 seconds --

-- Processing Outer Fold 2/2 --
Train set size: (1799, 63), Test set size: (1848, 63)
Test set indices range from 0 to 3596
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Best Params found: {'model__solver': 'saga', 'model__penalty': 'l2', 'model__max_iter': 1000, 'model__class_weight': 'balanced', 'model__C': 0.0001}
Best Inner CV PR-AUC score: 0.9446
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_2/best_params.json
CV metrics for best model: PR-AUC=0.9446, ROC-AUC=0.9549, F1=0.8290, Balanced Acc=0.8641
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_2/cv_metrics.json
Hyperparameter Tuning Duration: 1.00 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_2/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_2/predictions.csv
Default threshold (0.5): F1=0.7471
Optimal threshold (0.4015): F1=0.7836
Prediction & Evaluation Duration: 0.09 seconds
Calculating and saving SHAP values...
Calculating SHAP values using shap.Explainer with predict_proba for Pipeline...
Warning: Background data (X_background) not provided. Using 100 samples from X_test.
Returning 2D SHAP values array from shap.Explainer (predict_proba).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_2/shap_values_fold_2.csv (shape: (1848, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/fold_2/test_data_fold_2.csv (shape: (1848, 63))
SHAP Calculation & Saving Duration: 45.27 seconds
-- Outer Fold 2 finished. Duration: 46.37 seconds --

--- Aggregating results for: Logistic Regression (logistic) ---
Average Metrics across folds:
{
    "accuracy_mean": 0.885846724611316,
    "accuracy_std": 0.006469292704701257,
    "precision_mean": 0.8551091512874953,
    "precision_std": 0.017502313680657633,
    "recall_mean": 0.7371559633027522,
    "recall_std": 0.06284403669724775,
    "f1_mean": 0.7909353343701099,
    "f1_std": 0.0437942924387249,
    "roc_auc_mean": 0.941997670045875,
    "roc_auc_std": 0.0018045026991485025,
    "pr_auc_mean": 0.9070148529282578,
    "pr_auc_std": 0.031033909881626076,
    "balanced_accuracy_mean": 0.8405325922982552,
    "balanced_accuracy_std": 0.023560764972839987,
    "mcc_mean": 0.7139845489601382,
    "mcc_std": 0.02779074255188685,
    "best_inner_cv_pr_auc_mean": 0.9125620465855216,
    "best_inner_cv_pr_auc_std": 0.03203959660572531,
    "default_threshold_mean": 0.5,
    "default_threshold_std": 0.0,
    "optimal_threshold_mean": 0.6434304605975154,
    "optimal_threshold_std": 0.2419150310671233,
    "optimal_f1_mean": 0.81716800612323,
    "optimal_f1_std": 0.03357826253348645,
    "threshold_improvement_mean": 0.026232671753120107,
    "threshold_improvement_std": 0.010216029905238455,
    "threshold_used_mean": 0.5,
    "threshold_used_std": 0.0
}
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/metrics_summary.json
Combined predictions saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/logistic/all_predictions.csv

Running global SHAP analysis...
Combined SHAP values shape: (3647, 63)
Combined test data shape: (3647, 63)
Global SHAP analysis completed using data from all 2 folds
Global SHAP Analysis Duration: 1.39 seconds
Result Aggregation & Global SHAP Duration: 1.50 seconds
Average time per outer fold: 49.95 seconds
--- Nested CV completed for: Logistic Regression (logistic) ---
Total execution time for model 'logistic': 101.57 seconds

--- Overall Training Summary ---
Model comparison summary saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_renewal_20250429_042439/model_comparison_summary.csv
  model_name  accuracy_mean  ...  threshold_used_mean  threshold_used_std
0         rf       0.880340  ...                  0.5                 0.0
1        xgb       0.886167  ...                  0.5                 0.0
2        lgb       0.876156  ...                  0.5                 0.0
3   logistic       0.885847  ...                  0.5                 0.0

[4 rows x 29 columns]
Final Summary Saving Duration: 0.16 seconds

--- Framework Execution Finished ---
Total script execution time: 174.38 seconds
작업 완료
[INFO] Job completed at: Tue Apr 29 04:27:51 KST 2025
