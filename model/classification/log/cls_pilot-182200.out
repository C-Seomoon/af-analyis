=============================================
[INFO] Job Information
---------------------------------------------
[INFO] Job Name       : cls_framework
[INFO] Job ID         : 182200
[INFO] Submit Dir     : /home/cseomoon/appl/af_analysis-0.1.4/model/classification/scripts
[INFO] Partition      : a5000_short
[INFO] Node List      : gpu3
[INFO] Nodes          : 1
[INFO] CPUs per Task  : 24
[INFO] Memory (MB)    : 
[INFO] User           : cseomoon
[INFO] Work Dir       : /home/cseomoon/appl/af_analysis-0.1.4/model/classification/scripts
[INFO] Tasks per Node : 1
[INFO] Dependency     : 
[INFO] GPU(s)         : 
=============================================

[INFO] Job started at : Fri Apr 25 20:31:25 KST 2025
[INFO] Job allocated on node(s): gpu3
[INFO] Job running on: gpu3
[INFO] Results will be saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125
Using 24 CPU cores.
Results will be saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/run_arguments.json

--- Loading Data ---
Original data shape: (3650, 81)
Class distribution before NaN drop (DockQ >= 0.23): 0 (Negative) = 2529, 1 (Positive) = 1121
Identified 63 potential feature columns.
Checking for NaN values in potential feature columns...
Dropped 3 rows containing NaN values in one or more feature columns.
Processed Features (X) shape after NaN drop: (3647, 63)
Processed Target (y) shape after NaN drop: (3647,)
Processed Query IDs shape after NaN drop: (3647,)
Class distribution after NaN drop (DockQ >= 0.23): 0 (Negative) = 2526, 1 (Positive) = 1121
Data Loading & Preprocessing Duration: 0.07 seconds

--- Starting Model Training ---

--- Running Nested CV for: Random Forest (rf) ---
Output directory: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf
Using StratifiedGroupKFold for outer CV with 2 folds based on query IDs and stratified by y.

-- Processing Outer Fold 1/2 --
Train set size: (1848, 63), Test set size: (1799, 63)
Test set indices range from 100 to 3646
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Fitting 2 folds for each of 10 candidates, totalling 20 fits
Best Params found: {'n_estimators': 100, 'min_samples_split': 5, 'min_samples_leaf': 1, 'max_features': 'log2', 'max_depth': None, 'class_weight': 'balanced_subsample'}
Best Inner CV ROC AUC score: 0.9301
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_1/best_params.json
Hyperparameter Tuning Duration: 5.61 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_1/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_1/predictions.csv
Prediction & Evaluation Duration: 0.09 seconds
Calculating and saving SHAP values...
Calculating SHAP values for RandomForest using TreeExplainer...
Returning SHAP values for the positive class (from 3D array).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_1/shap_values_fold_1.csv (shape: (1799, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_1/test_data_fold_1.csv (shape: (1799, 63))
SHAP Calculation & Saving Duration: 2.50 seconds
-- Outer Fold 1 finished. Duration: 8.21 seconds --

-- Processing Outer Fold 2/2 --
Train set size: (1799, 63), Test set size: (1848, 63)
Test set indices range from 0 to 3596
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Fitting 2 folds for each of 10 candidates, totalling 20 fits
Best Params found: {'n_estimators': 200, 'min_samples_split': 2, 'min_samples_leaf': 2, 'max_features': 'log2', 'max_depth': 30, 'class_weight': 'balanced'}
Best Inner CV ROC AUC score: 0.9495
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_2/best_params.json
Hyperparameter Tuning Duration: 5.11 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_2/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_2/predictions.csv
Prediction & Evaluation Duration: 0.26 seconds
Calculating and saving SHAP values...
Calculating SHAP values for RandomForest using TreeExplainer...
Returning SHAP values for the positive class (from 3D array).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_2/shap_values_fold_2.csv (shape: (1848, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/fold_2/test_data_fold_2.csv (shape: (1848, 63))
SHAP Calculation & Saving Duration: 6.10 seconds
-- Outer Fold 2 finished. Duration: 11.48 seconds --

--- Aggregating results for: Random Forest (rf) ---
Average Metrics across folds:
{
    "accuracy_mean": 0.8781751646537639,
    "accuracy_std": 0.006023969545370322,
    "precision_mean": 0.8225771059368523,
    "precision_std": 0.037961721321467745,
    "recall_mean": 0.7472677961561642,
    "recall_std": 0.04543293377084312,
    "f1_mean": 0.783074030189068,
    "f1_std": 0.04215393333676781,
    "roc_auc_mean": 0.9330185360303593,
    "roc_auc_std": 0.0019688180170007175,
    "pr_auc_mean": 0.8825554631296422,
    "pr_auc_std": 0.01966243426837827,
    "balanced_accuracy_mean": 0.8390127233307255,
    "balanced_accuracy_std": 0.01784033463098289,
    "mcc_mean": 0.6972981003918092,
    "mcc_std": 0.028926905057972574,
    "best_inner_cv_roc_auc_mean": 0.9397965803909192,
    "best_inner_cv_roc_auc_std": 0.009713740889512434
}
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/rf/metrics_summary.json

Running global SHAP analysis...
Combined SHAP values shape: (3647, 63)
Combined test data shape: (3647, 63)
Global SHAP analysis completed using data from all 2 folds
Global SHAP Analysis Duration: 1.93 seconds
Result Aggregation & Global SHAP Duration: 1.97 seconds
Average time per outer fold: 9.85 seconds
--- Nested CV completed for: Random Forest (rf) ---
Total execution time for model 'rf': 21.70 seconds

--- Running Nested CV for: Logistic Regression (logistic) ---
Output directory: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic
Using StratifiedGroupKFold for outer CV with 2 folds based on query IDs and stratified by y.

-- Processing Outer Fold 1/2 --
Train set size: (1848, 63), Test set size: (1799, 63)
Test set indices range from 100 to 3646
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Fitting 2 folds for each of 10 candidates, totalling 20 fits
Best Params found: {'model__solver': 'saga', 'model__penalty': 'elasticnet', 'model__max_iter': 2000, 'model__l1_ratio': 0.1, 'model__class_weight': None, 'model__C': 0.005994842503189409}
Best Inner CV ROC AUC score: 0.9368
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_1/best_params.json
Hyperparameter Tuning Duration: 1.99 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_1/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_1/predictions.csv
Prediction & Evaluation Duration: 0.25 seconds
Calculating and saving SHAP values...
Calculating SHAP values using shap.Explainer with predict_proba for Pipeline...
Warning: Background data (X_background) not provided. Using 100 samples from X_test.
Returning 2D SHAP values array from shap.Explainer (predict_proba).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_1/shap_values_fold_1.csv (shape: (1799, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_1/test_data_fold_1.csv (shape: (1799, 63))
SHAP Calculation & Saving Duration: 49.90 seconds
-- Outer Fold 1 finished. Duration: 52.16 seconds --

-- Processing Outer Fold 2/2 --
Train set size: (1799, 63), Test set size: (1848, 63)
Test set indices range from 0 to 3596
Using StratifiedGroupKFold for inner CV with 2 folds.
Starting hyperparameter tuning (RandomizedSearchCV)...
Fitting 2 folds for each of 10 candidates, totalling 20 fits
Best Params found: {'model__solver': 'saga', 'model__penalty': 'elasticnet', 'model__max_iter': 2000, 'model__l1_ratio': 0.1, 'model__class_weight': None, 'model__C': 0.005994842503189409}
Best Inner CV ROC AUC score: 0.9570
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_2/best_params.json
Hyperparameter Tuning Duration: 1.84 seconds
Predicting on outer test set...
Calculating performance metrics...
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_2/metrics.json
Predictions saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_2/predictions.csv
Prediction & Evaluation Duration: 0.14 seconds
Calculating and saving SHAP values...
Calculating SHAP values using shap.Explainer with predict_proba for Pipeline...
Warning: Background data (X_background) not provided. Using 100 samples from X_test.
Returning 2D SHAP values array from shap.Explainer (predict_proba).
SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_2/shap_values_fold_2.csv (shape: (1848, 63))
Test data corresponding to SHAP values saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/fold_2/test_data_fold_2.csv (shape: (1848, 63))
SHAP Calculation & Saving Duration: 43.45 seconds
-- Outer Fold 2 finished. Duration: 45.44 seconds --

--- Aggregating results for: Logistic Regression (logistic) ---
Average Metrics across folds:
{
    "accuracy_mean": 0.8933930045311369,
    "accuracy_std": 0.016239030100897833,
    "precision_mean": 0.8750360490266762,
    "precision_std": 0.006542898341744763,
    "recall_mean": 0.7547729860041519,
    "recall_std": 0.027708765820665615,
    "f1_mean": 0.8102951357207204,
    "f1_std": 0.01878452398538949,
    "roc_auc_mean": 0.9432198543839848,
    "roc_auc_std": 0.004774484422709224,
    "pr_auc_mean": 0.9109546006077688,
    "pr_auc_std": 0.029475439284090355,
    "balanced_accuracy_mean": 0.8527299202046636,
    "balanced_accuracy_std": 0.006194977251730682,
    "mcc_mean": 0.7380192577802422,
    "mcc_std": 0.0011103752680531875,
    "best_inner_cv_roc_auc_mean": 0.9469339319044698,
    "best_inner_cv_roc_auc_std": 0.010095933009028613
}
Results saved to /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/logistic/metrics_summary.json

Running global SHAP analysis...
Combined SHAP values shape: (3647, 63)
Combined test data shape: (3647, 63)
Global SHAP analysis completed using data from all 2 folds
Global SHAP Analysis Duration: 1.38 seconds
Result Aggregation & Global SHAP Duration: 1.41 seconds
Average time per outer fold: 48.80 seconds
--- Nested CV completed for: Logistic Regression (logistic) ---
Total execution time for model 'logistic': 99.03 seconds

--- Overall Training Summary ---
Model comparison summary saved to: /home/cseomoon/appl/af_analysis-0.1.4/model/classification/results/cls_pilot_20250425_203125/model_comparison_summary.csv
  model_name  ...  best_inner_cv_roc_auc_std
0         rf  ...                   0.009714
1   logistic  ...                   0.010096

[2 rows x 19 columns]
Final Summary Saving Duration: 0.11 seconds

--- Framework Execution Finished ---
Total script execution time: 121.01 seconds
작업 완료
[INFO] Job completed at: Fri Apr 25 20:33:36 KST 2025
